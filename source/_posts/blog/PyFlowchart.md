---
date: 2020-10-24 12:42:44.471978
tags: Python
title: Python ä»£ç è½¬æµç¨‹å›¾
---
# Python ä»£ç è½¬æµç¨‹å›¾

åœ¨è®¾è®¡ç¨‹åºæ—¶ï¼Œç±»å›¾ã€æµç¨‹å›¾éƒ½æ˜¯å¾ˆæœ‰ç”¨çš„å·¥å…·ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šå·¥å…·æ¥ç»˜åˆ¶è¿™äº›å›¾çº¸ï¼Œç”šè‡³è¿˜èƒ½ç”¨å®ƒä»¬ç”Ÿæˆæœ€åŸºæœ¬çš„æ¡†æ¶ä»£ç ã€‚ä¹Ÿæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠå·²ç»å†™å¥½çš„ä»£ç åå‘è½¬æˆç±»å›¾ã€æµç¨‹å›¾ï¼Œæ¯”å¦‚~~å†™ä½œä¸š~~å’Œåˆ«äººåˆ†äº«è®¾è®¡çš„æ—¶å€™ã€‚

ä»£ç è½¬ç±»å›¾ä¹Ÿæœ‰æŒºå¤šå·¥å…·çš„ï¼ŒVS Codeã€IntelliJ IDEA è¿™äº›å¸¸ç”¨çš„ IDE éƒ½å¯ä»¥è£…æ’ä»¶æ¥å®Œæˆè¿™ä¸€å·¥ä½œã€‚è€Œå¦‚æœä½ åšå¾®è½¯å®¶çš„å¼€å‘ï¼ŒVisual Studio å¯é€‰å®‰è£…çš„â€œç±»è®¾è®¡å™¨â€ï¼Œæ›´æ˜¯å¼ºåˆ°ä¸åƒè¯ï¼Œè½»æ¾åŠæ‰“æˆ‘è§è¿‡çš„å…¶ä»–ä»»ä½•åŒç±»å·¥å…·ï¼Œå°±è¿™ä¸€ç‚¹æ¥è¯´ï¼Œ VS å¯¹å¾—èµ·ã€Œå®‡å®™ç¬¬ä¸€ IDEã€çš„ç§°å·ã€‚

ç„¶è€Œï¼Œä»£ç è½¬æµç¨‹å›¾ï¼Œç›¸å¯¹æ¥è¯´ï¼Œè¿™ä¸ªéœ€æ±‚å°‘ä¸€äº›ï¼Œå·¥å…·ä¹Ÿæ²¡é‚£ä¹ˆä¸°å¯Œã€‚æœ€è¿‘æˆ‘çªç„¶éœ€è¦æŠŠä¸€äº› Python ä»£ç è½¬æˆæµç¨‹å›¾ï¼ŒGoogle ç¿»äº†ä¸¤é¡µï¼ŒGitHub æœäº†å‡ ä¸ªé¡¹ç›®ï¼Œå‘ç°ç°æœ‰çš„å®ç°éƒ½ä¸å¤ªè¡Œï¼šè¦ä¹ˆç”¨çš„æŠ€æœ¯å¤ªæ€ªï¼ˆé‚£äº›ç”¨ã€Œæ­£åˆ™è¡¨è¾¾å¼ã€æ­£é¢ä¸Šçš„å¯éœ‡æ’¼äº†æˆ‘ä¸€ä¸‹åˆï¼‰ï¼Œè¦ä¹ˆè·‘ä¸èµ·æ¥ï¼ˆä¾èµ–æ¡ä»¶è‹›åˆ»ï¼Œæ¯”å¦‚æŸäº›é¡¹ç›®ç”¨äº†å¯¹ macOS ä¸å¤ªå‹å¥½çš„ PyGameï¼‰ï¼Œè¦ä¹ˆè·‘å‡ºæ¥å¤ªä¸‘ï¼ˆå‡Œä¹±çš„çº¿æ¡ã€å¥‡æ€ªçš„é¢œè‰²ï¼Œä¸æ˜¯æ–°ä¸‘é£ï¼Œæ˜¯ä¸‘åˆ°æŠ½é£ï¼‰ã€‚ å½“æˆ‘çœ‹åˆ°æŸé«˜èµé¡¹ç›® [Vatsha/code_to_flowchart](https://github.com/Vatsha/code_to_flowchart) ç”šè‡³é›†åˆäº†ä¸Šè¿°ä¸‰å¤§â€œä¼˜ç‚¹â€æ—¶ï¼Œï¼Œï¼Œæˆ‘é€‰æ‹©äº†è‡ªå·±åŠ¨æ‰‹æ’¸ä¸€ä¸ª python to flowchart çš„å·¥å…·ã€‚

å½“ç„¶ï¼Œæˆ‘ä¸æ˜¯å–· [Vatsha/code_to_flowchart](https://github.com/Vatsha/code_to_flowchart)ï¼Œåªæ˜¯å…¶ä¸€äº›ç»†èŠ‚çœŸçš„æ¬ ä¼˜ï¼Œæœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ã€‚ä½†ä¸å¾—ä¸è¯´ï¼Œä»–çš„è®¾è®¡ç®€å•æœ‰æ•ˆ ï¼Œç”¨ PyGame åšå¯è§†åŒ–ä¹Ÿå¾ˆæœ‰æ–°æ„ã€‚å…¶å®ï¼Œæˆ‘åœ¨åšè‡ªå·±çš„å®ç°æ—¶ä¹Ÿå¤§é‡å‚è€ƒäº†è¿™ä¸ªé¡¹ç›®ã€‚

---

æˆ‘çš„è§£å†³æ–¹æ¡ˆ [PyFlowchart](https://github.com/cdfmlr/pyflowchart) åŸºäºå¤§åé¼é¼çš„ flowchart.jsã€‚

ï¼ˆæœ¬æ¥æˆ‘æ˜¯å–åå«åš PyFlow çš„ï¼Œä¸Šä¼  PyPi çš„æ—¶å€™å‘ç°é‡åäº†ğŸ¤¦â€â™‚ï¸ã€‚æ‰€ä»¥æ”¹æˆäº† PyFlowchartï¼‰

## flowchart.js

å¦‚æœä½ ä½¿ç”¨ Typoraï¼Œå¯èƒ½çŸ¥é“åœ¨ Typora ä¸­ç”¨  \`\`\`flow å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„æ–‡æœ¬è¯­è¨€æ¥å†™æµç¨‹å›¾ï¼Œæ ¹æ® [Typora çš„æ–‡æ¡£](https://support.typora.io/Draw-Diagrams-With-Markdown/#flowcharts)ï¼Œè¿™ä¸ªåŠŸèƒ½æ¥è‡ªå¼€æºçš„ [flowchart.js](https://github.com/adrai/flowchart.js)ã€‚

æˆ‘çš„æ–¹æ¡ˆå°±æ˜¯æŠŠ Python ä»£ç è½¬åŒ–æˆè¿™ç§ flowchart è¯­è¨€ï¼Œç„¶åä½ å°±å¯ä»¥å€ŸåŠ©  [flowchart.js.org](http://flowchart.js.org/)ã€[Typora](https://www.typora.io)ã€ [francoislaberge/diagrams](https://github.com/francoislaberge/diagrams/#flowchart) ç­‰ç­‰å·¥å…·æ¥ç”Ÿæˆæµç¨‹å›¾äº†ã€‚

```
st=>start: Start
op=>operation: Your Operation
cond=>condition: Yes or No?
e=>end

st->op->cond
cond(yes)->e
cond(no)->op
```

![flowchart](https://tva1.sinaimg.cn/large/0081Kckwly1gk07vvnullj30uo0luaa3.jpg)

## PyFlowchart

ä¸‹é¢ç®€è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨æˆ‘å®ç°çš„ PyFlowchartï¼Œæ›´è¯¦ç»†çš„è¯´æ˜è¯·çœ‹é¡¹ç›®çš„ [README](https://github.com/cdfmlr/pyflowchart/blob/master/README.md)ã€‚

å®‰è£… PyFlowchartï¼š

```sh
$ pip3 install pyflowchart
```

å†™ä¸€ä¸ª `simple.py` æ–‡ä»¶ï¼š

```python
def foo(a, b):
    if a:
        print("a")
    else:
        for i in range(3):
            print("b")
    return a + b
```

è¿è¡Œ PyFlowchartï¼š

```sh
$ python3 -m pyflowchart simple.py
```

å®ƒä¼šè¾“å‡º flowchart ä»£ç ï¼š

```
st4439920016=>start: start foo
io4439920208=>inputoutput: input: a, b
cond4439920592=>condition: if a
sub4439974736=>subroutine: print('a')
io4439974672=>inputoutput: output:  (a + b)
e4439974352=>end: end function return
cond4439974224=>operation: print('b') while  i in range(3)

st4439920016->io4439920208
io4439920208->cond4439920592
cond4439920592(yes)->sub4439974736
sub4439974736->io4439974672
io4439974672->e4439974352
cond4439920592(no)->cond4439974224
cond4439974224->io4439974672
```

è®¿é—® [flowchart.js.org](http://flowchart.js.org)ï¼ŒæŠŠä¸Šé¢ç”Ÿæˆçš„ä»£ç ç²˜è´´åˆ°æ–‡æœ¬æ¡†é‡Œï¼Œå³è¾¹å°±ä¼šè‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾äº†ï¼š

![flowchart.js.org æˆªå›¾ï¼Œå·¦è¾¹çš„è¾“å…¥æ¡†é‡Œç²˜è´´äº†ç”Ÿæˆçš„ä»£ç ï¼Œå³è¾¹æ˜¯ç”»å‡ºçš„æµç¨‹å›¾](https://tva1.sinaimg.cn/large/0081Kckwly1gk083edrrgj312j0sc4d2.jpg)

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥æŠŠè¿™äº›ä»£ç æ”¾åˆ° Typora çš„ flow ä»£ç å—é‡Œï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾ã€‚å¦‚æœä½ å–œæ¬¢ä½¿ç”¨å‘½ä»¤è¡Œï¼Œä¹Ÿå¯ä»¥ç”¨ [francoislaberge/diagrams](https://github.com/francoislaberge/diagrams/#flowchart) æ¥ç”Ÿæˆæµç¨‹å›¾ã€‚

å¦‚æœç”Ÿæˆçš„æµç¨‹å›¾æœ‰è®©äººä¸æ»¡æ„çš„åœ°æ–¹ï¼ˆæ¯”å¦‚ï¼Œçº¿æ¡é‡å ï¼‰æˆ–è€…ä½ å–œæ¬¢æŒ‡å®šæ ·å¼ï¼Œå‚è€ƒ [flowchart.js.org](http://flowchart.js.org)ï¼Œæ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ç”Ÿæˆçš„ flowchart å°±å¯ä»¥äº†ï¼Œéå¸¸æ–¹ä¾¿ã€‚

## å®ç°åŸç†

```flow
st=>start: start PyFlowchart
in=>inputoutput: input python source code
sub1=>subroutine: code to ast
sub2=>subroutine: ast to node graph
sub3=>subroutine: node graph to flowchart
out=>inputoutput: output flowchart
e=>end: end

st->in->sub1(right)->sub2(right)->sub3->out->e
```

![å®ç°åŸç†æµç¨‹å›¾](https://tva1.sinaimg.cn/large/0081Kckwly1gk0bxkyis0j31k00u0tb8.jpg)

PyFlowchart åˆ©ç”¨ Python å†…ç½®çš„ [ast](https://docs.python.org/zh-cn/3/library/ast.html) åŒ…ï¼ŒæŠŠä»£ç è½¬åŒ–æˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œç„¶åæŠŠ AST è½¬åŒ–æˆè‡ªå·±å®šä¹‰çš„ Node ç»„æˆçš„å›¾ï¼Œæ¯ä¸ª Node å¯¹åº”ä¸€ä¸ª flowchart ä¸­çš„ nodeï¼Œéå†è¿™ä¸ªå›¾å°±å¯ä»¥å¾—åˆ°æµç¨‹å›¾äº†ã€‚

å…³äº ast åŒ…ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š[AST æ¨¡å—ï¼šç”¨ Python ä¿®æ”¹ Python ä»£ç ](https://pycoders-weekly-chinese.readthedocs.io/en/latest/issue3/static-modification-of-python-with-python-the-ast-module.html)ï¼Œè™½ç„¶å¾ˆè€ï¼Œä½†ååˆ†ç®€å•æ˜“æ‡‚ã€‚æ€»è€Œè¨€ä¹‹ï¼Œåˆ©ç”¨ ast åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€æ®µ Python ä»£ç è½¬åŒ–ä¸ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼š

```python
>>> import ast
>>> expr = """
... def add(a, b):
...     return a + b
... """
>>> expr_ast = ast.parse(expr)
>>> expr_ast
<_ast.Module object at 0x10c773e10>
>>> ast.dump(expr_ast)
# p.s. è¿™é‡Œæ‰‹åŠ¨åšäº†æ ¼å¼åŒ–
Module(body=[FunctionDef(name='add',
  args=arguments(
    args=[
      arg(arg='a', annotation=None),
      arg(arg='b', annotation=None)],
    vararg=None, kwonlyargs=[], kw_defaults=[], kwarg=None, defaults=[]),
  body=[Return(value=BinOp(
    left=Name(id='a', ctx=Load()),
    op=Add(),
    right=Name(id='b', ctx=Load())))],
  decorator_list=[],
  returns=None)])
```

å­¦ä¼šäº†è¿™ä¸ªä¸œè¥¿ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯æŠŠè¿™ä¸ª expr_ast (_ast.Module å¯¹è±¡) ç¿»è¯‘æˆæµç¨‹å›¾äº†ã€‚æˆ‘ä»¬ç”¨é¢å‘å¯¹è±¡æ¥çš„æ–¹æ³•æ¥å®ç°ï¼š

![pyflowchart.node](https://tva1.sinaimg.cn/large/0081Kckwly1gk0b5o486pj31hz0u042n.jpg)

`Node` æ˜¯æœ€æœ€åŸºç¡€çš„ç±»ï¼Œè¡¨ç¤ºæµç¨‹å›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä»–ä¸€åˆ‡éƒ½ç»§æ‰¿è‡ªå®ƒã€‚Node æœ‰èŠ‚ç‚¹ç±»å‹ã€åç§°ã€å†…å®¹ç­‰å±æ€§ï¼Œæä¾›çš„ `fc_definition()`ã€`fc_connection()` æ–¹æ³•å¯ä»¥æŠŠè‡ªå·±è½¬åŒ–ä¸º flowchart è¯­è¨€çš„å­—ç¬¦ä¸²ã€‚å¦å¤–çš„ `__visited` å’Œ `_traverse()` æ˜¯ç”¨æ¥éå†å›¾çš„ã€‚ä¸ flowchart ä¸­çš„ node types å¯¹åº”ï¼Œæˆ‘ä»¬å®ç°äº†å„ç§ Node çš„å­ç±»ï¼šStartNodeã€EndNodeã€OperationNode......

`NodesGroup` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Nodeï¼Œå®ƒè‡ªå·±ä¸ä¼šå‡ºç°åœ¨ç”Ÿæˆçš„ flowchart ä¸­ï¼Œä½†å®ƒå¯ä»¥åŒ…å«ä¸€äº›å…¶ä»– Nodeã€‚è¿™ä¸ªè®¾è®¡æ˜¯å—åˆ° Android çš„ Viewã€ViewGroup çš„å¯å‘ï¼Œæœ‰äº†è¿™ä¸ª NodesGroupï¼Œif è¯­å¥ã€for / while å¾ªç¯è¿™æ ·æœ‰åµŒå¥—çš„ body çš„æƒ…å†µå°±å¾ˆå®¹æ˜“å¤„ç†äº†ã€‚

`AstNode` è¡¨ç¤ºä¸€ä¸ªä» AST å¯¹è±¡å¾—åˆ°çš„ Nodeã€‚æ„é€  AstNodeï¼Œå°±æ˜¯æŠŠæŸä¸ª AST å¯¹è±¡ç¿»è¯‘æˆä¸€ä¸ª Nodeï¼ˆä¹Ÿå¯ä»¥æ˜¯ NodesGroupï¼‰ã€‚å…¶å­ç±»å°±å’Œå„ç§ ast å¯¹è±¡å¯¹åº”ï¼ˆä¹Ÿå°±å’Œ Python çš„å„ç§è¯­å¥å¯¹åº”ï¼‰ï¼š Ifã€Loopã€Return .......

`Flowchart` ä»£è¡¨ä¸€å¼ æµç¨‹å›¾ã€‚æµç¨‹å›¾å°±æ˜¯ä¸€å †è¿åœ¨ä¸€èµ·çš„èŠ‚ç‚¹å˜›ï¼Œæ‰€ä»¥ Flowchart æ˜¯ NodesGroup çš„å­ç±»ã€‚åœ¨å…¶ `from_code()` ä¸­æ–¹æ³•ä¸­ï¼Œå®ç°äº†ç”¨ ast åŒ…è§£æ Python ä»£ç ï¼Œå¾—åˆ° ast å¯¹è±¡çš„å·¥ä½œã€‚åœ¨ `flowchart()` æ–¹æ³•ä¸­ï¼Œéå†å›¾ï¼Œæ‹¿åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ flowchart è¡¨ç¤ºï¼Œæ±‡æ€»æˆä¸€å¼ å®Œæ•´çš„ flowchart æµç¨‹å›¾ã€‚ 

å…¶å®è¿™ä¸ªä¸œè¥¿å¾ˆç®€å•ï¼Œæ›´å…·ä½“çš„å®ç°çœ‹æºç å°±å¾ˆå¥½ç†è§£äº†ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚æ€»ç»“ä¸€ä¸‹ï¼š

- Flowchart ä¸­åˆ©ç”¨ ast åŒ…å®ç°äº† code to astï¼›
- AstNode åŠå…¶å­ç±»å®ç°äº† ast to node graphï¼›
- Node åŠå…¶å­ç±»å®ç°äº† node graph to flowchartã€‚

é™„ä¸Šé¡¹ç›®åœ°å€ä¸å®Œæ•´å®ç°çš„ç±»å›¾ï¼š

- https://github.com/cdfmlr/pyflowchart/

![pyflowchart](https://tva1.sinaimg.cn/large/0081Kckwly1gk09oeitndj33xl0u0wx7.jpg)

```python
by('CDFMLR', '2020.10.24')
# ğŸ‰
```
